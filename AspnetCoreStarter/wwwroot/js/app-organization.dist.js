"use strict";$(function(){var e,a=$(".datatables-organizations");a.length&&(e=a.DataTable({ajax:{url:"/api/Organization",dataSrc:"",complete:function(){}},columns:[{data:""},{data:"id"},{data:"organizationName"},{data:"orgRole"},{data:"license"},{data:"licenseValidTill"}],columnDefs:[{className:"control",orderable:!1,searchable:!1,responsivePriority:2,targets:0,render:function(e,a,t,n){return""}},{targets:1,searchable:!1,visible:!1},{targets:2,render:function(e,a,t,n){return'<span class="text-nowrap">'+t.organizationName+"</span>"}},{targets:3,orderable:!1,render:function(e,a,t,n){var o="";return'<span class="text-nowrap">'+(o+={ADMINISTRATOR:'<span class="badge bg-label-primary m-1">Administrator</span>',EDITOR:'<span class="badge bg-label-warning m-1">Editor</span>',EXECUTOR:'<span class="badge bg-label-success m-1">Executor</span>'}[t.orgRole])+"</span>"}},{targets:4,orderable:!1,render:function(e,a,t,n){var o=t.license,r="",t=t.licenseValidTill,s='<span class="badge bg-label-danger m-1">EXPIRED</span>',i='<span class="badge bg-label-warning m-1">NO LICENSE</span>';return o?r+='<span class="badge bg-label-success m-1">VALID</span>':isAvail(t)&&""!=t?r+=s:r+=i,'<span class="text-nowrap">'+r+"</span>"}},{targets:5,orderable:!1,render:function(e,a,t,n){var t=t.licenseValidTill,o="";return'<span class="text-nowrap">'+(o=isAvail(t)&&""!=t?moment(t).format("MMM Do YY"):o)+"</span>"}}],order:[[1,"asc"]],dom:'<"row mx-1"<"col-sm-12 col-md-3" l><"col-sm-12 col-md-9"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-md-end justify-content-center flex-wrap me-1"<"me-3"f>B>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"Show _MENU_",search:"Search",searchPlaceholder:"Search.."},buttons:[],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){return"Details of "+e.data().name}}),type:"column",renderer:function(e,a,t){t=$.map(t,function(e,a){return""!==e.title?'<tr data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'"><td>'+e.title+":</td> <td>"+e.data+"</td></tr>":""}).join("");return!!t&&$('<table class="table"/><tbody />').append(t)}}},initComplete:function(){this.api().columns(3).every(function(){var a=this,t=$('<select id="UserRole" class="form-select text-capitalize"><option value=""> Select Role </option></select>').appendTo(".user_role").on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());a.search(e?"^"+e+"$":"",!0,!1).draw()});a.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'" class="text-capitalize">'+e+"</option>")})})}})),$(".datatables-organizations tbody").on("click",".delete-record",function(){e.row($(this).parents("tr")).remove().draw()}),setTimeout(()=>{$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm")},300)}),document.addEventListener("DOMContentLoaded",function(e){FormValidation.formValidation(document.getElementById("addOrganizationForm"),{fields:{Name:{validators:{notEmpty:{message:"Please enter organization name"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".form-field"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus},init:e=>{e.on("plugins.message.placed",function(e){e.element.parentElement.classList.contains("input-group")&&e.element.parentElement.insertAdjacentElement("afterend",e.messageElement)})}}).on("core.form.valid",function(t){var n={};$.each(t.formValidation.form,function(e,a){null!=t.formValidation.fields[a.name]&&(n[a.name]=a.value)}),$.ajax({url:"/api/Organization",type:"POST",contentType:"application/json",data:JSON.stringify(n),success:function(e){e.status?(Swal.fire({title:"Success!",text:"Organization has been created!",icon:"success",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1}).then(()=>{$(".datatables-organizations").DataTable().ajax.reload(),location.reload()}),$("#addOrganizationModal").modal("hide")):Swal.fire({title:"Error!",text:e.errorMessage,icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})},error:function(e){Swal.fire({title:"Error!",text:"There was an error while adding organization!",icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})}})})});